{% extends "main.html" %}

{% block title %}Students{% endblock title %}



{% block main %}
<div class="space-y-6">

  <!-- Page Header -->
  <div class="flex items-center justify-between">
    <div>
      <h1 class="text-2xl font-semibold">Students</h1>
      <p class="text-sm opacity-60">Manage student accounts</p>
    </div>

    <a href="{% url 'add_students' %}"><button class="btn btn-primary">
      <i data-lucide="plus" class="w-4 h-4"></i>
      Add Student
    </button></a>
  </div>


  <form method="get" class="sticky top-4 z-20">
  <div class="flex flex-col md:flex-row md:items-center gap-3 p-4 bg-base-200 rounded-lg shadow-sm">

    <div class="relative w-full md:w-64">
      <input
        type="text"
        name="search"
        placeholder="Search name / ID"
        value="{{ request.GET.search }}"
        class="input input-sm input-bordered w-full pl-10"
      />
      <i data-lucide="search" class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"></i>
    </div>

    <select name="bus" class="select select-sm select-bordered w-full md:w-52">
      <option value="">All Buses</option>
      {% for bus in buses %}
        <option value="{{ bus.id }}" {% if request.GET.bus == bus.id|stringformat:"s" %}selected{% endif %}>
          {{ bus.name }}
        </option>
      {% endfor %}
    </select>

    <select name="status" class="select select-sm select-bordered w-full md:w-40">
      <option value="">All Status</option>
      <option value="Active" {% if request.GET.status == "Active" %}selected{% endif %}>Active</option>
      <option value="Inactive" {% if request.GET.status == "Inactive" %}selected{% endif %}>Inactive</option>
    </select>

    <div class="md:ml-auto flex gap-2 items-center">
      <a href="{% url 'students' %}" class="btn btn-sm btn-error">Reset</a>
      <button type="submit" class="btn btn-sm btn-primary">Apply</button>
    </div>

  </div>
</form>

  <!-- Students Table -->
  <div class="card bg-base-100 shadow-sm rounded-lg overflow-hidden">
<div class="overflow-x-auto md:overflow-x-visible">
      <table class="table table-zebra w-full">
        <thead class="bg-base-200 sticky top-0 z-10">
          <tr>
            <th><input type="checkbox" class="checkbox" id="selectAll" /></th>
            <th>Student</th>
            <th>Email</th>
            <th>Bus Assignment</th>
            <th>Phone</th>
            <th class="text-right">Actions</th>
          </tr>
        </thead>
        <tbody id="student-tbody">
          {% if students %}
          {% for student in students %}
          <tr>
            <th>
              <input type="checkbox" class="checkbox rowCheck" data-index="0" />
            </th>
            <td>
              <div class="flex items-center gap-3">
                <div class="avatar">
                  <div class="mask mask-squircle w-11">
                    <img src="{{ student.user.avatar.url}}" alt="Avatar" />
                  </div>
                </div>
                <div>
                  <div class="font-bold">{{ student.user.first_name }}</div>
                  <div class="text-sm opacity-50">{{ student.license_id }}</div>
                </div>
              </div>
            </td>
            <td class="text-sm">{{student.user.email}}</td>
            <td>
              {% if student.bus_id %}
              <span class="badge badge-info">{{ student.bus_id.name }}</span>
              {% else %}
              <span class="text-gray-400">Unassigned</span>
              {% endif %}

            </td>
            <td>{{ student.user.phone }}</td>
            <td class="text-right space-x-1">
              <button class="btn btn-square w-8 h-8 tooltip" data-tip="View">
                <i data-lucide="eye" class="w-4 h-4"></i>
              </button>
              <button class="btn btn-square w-8 h-8 tooltip delete-single" data-index="0" data-tip="Delete">
                <i data-lucide="trash-2" class="w-4 h-4 text-error"></i>
              </button>
              <button class="btn btn-square w-8 h-8 tooltip" data-tip="Reset Password">
                <i data-lucide="key-round" class="w-4 h-4"></i>
              </button>
            </td>
          </tr>
          {% endfor %}
          {% else %}
          <tr><td colspan="6" class="py-8 text-center text-sm opacity-60">
          No students match the current filters
        </td></tr>
          {% endif %}

        </tbody>
        <tfoot>
          <tr>
            <td colspan="100%">
              <div class="flex justify-between items-center p-4 border-t border-base-200 w-full">
                <div class="flex items-center gap-2">
                  <span class="text-sm text-base-content/70">Items per page</span>
                  <select class="select select-bordered select-sm" id="pageSize"
                    onchange="location = '?page_size=' + this.value">
                    <option value="10" {% if page_obj.paginator.per_page == 10 %}selected{% endif %}>10</option>
                    <option value="20" {% if page_obj.paginator.per_page == 20 %}selected{% endif %}>20</option>
                    <option value="50" {%if page_obj.paginator.per_page == 50 %}selected{% endif %}>50</option>
                  </select>
                </div>
                <div class="hidden sm:block text-sm text-base-content/70">
                  <span id="rangeText"></span>
                </div>
                <div class="join">
                  {% if page_obj.has_previous %}
                  <a href="?page={{ page_obj.previous_page_number }}" class="join-item btn btn-sm btn-outline">
                    Prev
                  </a>
                  {% else %}
                  <button class="join-item btn btn-sm btn-outline" disabled>
                    Prev
                  </button>
                  {% endif %}

                  <button class="join-item btn btn-sm btn-outline btn-active">
                    {{ page_obj.number }}
                  </button>

                  {% if page_obj.has_next %}
                  <a href="?page={{ page_obj.next_page_number }}" class="join-item btn btn-sm btn-outline">
                    Next
                  </a>
                  {% else %}
                  <button class="join-item btn btn-sm btn-outline" disabled>
                    Next
                  </button>
                  {% endif %}
                </div>
              </div>
            </td>
          </tr>
        </tfoot>
      </table>
    </div>
  </div>

</div>

<script>
  document.getElementById('reset').addEventListener('click', () => {
  document.getElementById('searchInput').value = '';
  document.getElementById('busSelect').value = '';
  document.getElementById('statusSelect').value = '';
});
const checkboxes = document.querySelectorAll('.rowCheck');
const selectedCount = document.getElementById('selectedCount');
checkboxes.forEach(cb => cb.addEventListener('change', () => {
  const count = document.querySelectorAll('.rowCheck:checked').length;
  selectedCount.textContent = `${count} selected`;
}));



</script>

{% endblock main %}